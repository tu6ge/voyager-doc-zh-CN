(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{155:function(t,s,a){t.exports=a.p+"assets/img/role.6659985e.png"},194:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"角色和权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#角色和权限"}},[t._v("#")]),t._v(" 角色和权限")]),t._v(" "),e("p",[t._v("Voyager有现成的角色和权限。Voyager会为每个用户都分配一个角色，每个角色都有一组权限。")]),t._v(" "),e("p",[t._v("在管理后台，您可以选择添加、编辑或删除角色。另外，当您单击以编辑特定角色时，可以指定BREAD权限。")]),t._v(" "),e("p",[e("img",{attrs:{src:a(155),alt:""}})]),t._v(" "),e("p",[t._v("新版本1.0中，我们已经更改了旅行者的授权系统，使其"),e("a",{attrs:{href:"https://laravel.com/docs/authorization#authorizing-actions-using-policies",target:"_blank",rel:"noopener noreferrer"}},[t._v("更符合Laravel"),e("OutboundLink")],1),t._v(".\n这意味着您可以通过以下方式检查权限")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// via user object")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$canViewPost")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$user")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("can")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'read'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$post")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$canViewPost")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Auth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("can")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'read'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$post")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// via controller")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$canViewPost")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("authorize")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'read'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$post")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("默认情况下，您可以使用一些现成的权限:")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("browse_admin")]),t._v(": 允许或拒绝用户浏览Voyager 管理面板")]),t._v(" "),e("li",[e("code",[t._v("browse_database")]),t._v(": 允许或拒绝用户浏览Voyager 数据库管理器")]),t._v(" "),e("li",[e("code",[t._v("browse_bread")]),t._v(": 允许或拒绝用户浏览Voyager BREAD管理器")]),t._v(" "),e("li",[e("code",[t._v("browse_media")]),t._v(": 允许或拒绝用户浏览Voyager 媒体管理器")]),t._v(" "),e("li",[e("code",[t._v("browse_menu")]),t._v(": 允许或拒绝用户浏览Voyager 菜单管理器")]),t._v(" "),e("li",[e("code",[t._v("browse_settings")]),t._v(": 允许或拒绝用户浏览Voyager 网站设置")]),t._v(" "),e("li",[e("code",[t._v("read_settings")]),t._v(": 允许或拒绝用户浏览Voyager 查看或读取网站设置")]),t._v(" "),e("li",[e("code",[t._v("edit_settings")]),t._v(": 允许或拒绝用户浏览Voyager 编辑网站设置")]),t._v(" "),e("li",[e("code",[t._v("add_settings")]),t._v(": 允许或拒绝用户浏览Voyager 添加网站设置")]),t._v(" "),e("li",[e("code",[t._v("delete_settings")]),t._v(": 允许或拒绝用户浏览Voyager 删除网站设置")])]),t._v(" "),e("p",[t._v("另外，当你生成每一个BREAD类型的时候，会有一个"),e("code",[t._v("生成权限")]),t._v("的选项，选中后会自动生成"),e("code",[t._v("browse")]),t._v(", "),e("code",[t._v("read")]),t._v(", "),e("code",[t._v("edit")]),t._v(", "),e("code",[t._v("add")]),t._v(" 和 "),e("code",[t._v("delete")]),t._v("权限")]),t._v(" "),e("p",[t._v("例如, 我们已经为"),e("code",[t._v("products")]),t._v("表创建了一个新的BREAD类型. 如果我们选中了"),e("code",[t._v("生成权限")]),t._v("选项. 我们的权限列表中会增加 "),e("code",[t._v("browse_products")]),t._v(", "),e("code",[t._v("read_products")]),t._v(", "),e("code",[t._v("edit_products")]),t._v(", "),e("code",[t._v("add_products")]),t._v(" 和 "),e("code",[t._v("delete_products")]),t._v("这些权限")]),t._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),e("p",[t._v("如果菜单项与任一BREAD关联，则它将检查"),e("code",[t._v("browse")]),t._v("权限，例如“Posts”BREAD菜单项，它将检查"),e("code",[t._v("browse_posts")]),t._v("权限。如果用户没有该权限，则该菜单项将不会显示。")])]),t._v(" "),e("h2",{attrs:{id:"为自定义页面创建权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为自定义页面创建权限"}},[t._v("#")]),t._v(" 为自定义页面创建权限")]),t._v(" "),e("p",[t._v("如果创建自定义页，并且只希望允许特定用户角色访问该页，则可以使用权限。")]),t._v(" "),e("p",[t._v("只有当slug直接位于"),e("code",[t._v("/admin/")]),t._v("之后才有效。因此对于"),e("code",[t._v("/admin/sub/foo")]),t._v("这种的自定义页面，菜单项不会从菜单中隐藏。")]),t._v(" "),e("h3",{attrs:{id:"创建权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#创建权限"}},[t._v("#")]),t._v(" 创建权限")]),t._v(" "),e("p",[t._v("首先，在permissions表中创建一个权限（你可以使用BREAD ，model名称是"),e("code",[t._v("TCG\\Voyager\\Models\\Permission")]),t._v("来创建）。"),e("code",[t._v("table_name")]),t._v("字段应设置为空。"),e("code",[t._v("key")]),t._v("字段的格式应为 "),e("code",[t._v("browse_slug")]),t._v("，其中 "),e("code",[t._v("slug")]),t._v("必须替换为自定义页的实际slug。例如，要限制对url"),e("code",[t._v("/admin/create_bill")]),t._v("的自定义页的访问，可以创建"),e("code",[t._v("browse_create_bill")]),t._v("权限。")]),t._v(" "),e("h3",{attrs:{id:"设置角色"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置角色"}},[t._v("#")]),t._v(" 设置角色")]),t._v(" "),e("p",[t._v("在"),e("code",[t._v("admin/roles")]),t._v("路径中检查要授予访问站点的每个角色的权限。在上面的例子中，您会发现一个名为“浏览创建账单”的新复选框。如果用户没有所需的权限，则指向自定义页的菜单项将被隐藏。")]),t._v(" "),e("h3",{attrs:{id:"自定义的控制器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#自定义的控制器"}},[t._v("#")]),t._v(" 自定义的控制器")]),t._v(" "),e("p",[t._v("你可以创建自己的 "),e("a",{attrs:{href:"https://learnku.com/docs/laravel/5.8/authorization/3908#gates",target:"_blank",rel:"noopener noreferrer"}},[t._v("Gate"),e("OutboundLink")],1)]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[t._v("Gate"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("define")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`browse_create_bill`"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$user")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$user")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("hasPermission")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("`browse_create_bill`"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("在你的控制器中使用 "),e("code",[t._v("authorize")]),t._v(" :")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$this")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("authorize")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'browse_create_bill'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//..")]),t._v("\n")])])]),e("p",[t._v("如果这样做，请确保将自定义看守器添加到了控制器:")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[t._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n   * Get the guard to be used during authentication.\n   *\n   * @return \\Illuminate\\Contracts\\Auth\\StatefulGuard\n   */")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("guard")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Auth"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("guard")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("app")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'VoyagerGuard'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("h2",{attrs:{id:"在blade模板中使用权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在blade模板中使用权限"}},[t._v("#")]),t._v(" 在Blade模板中使用权限")]),t._v(" "),e("p",[t._v("您还可以使用blade语法检查权限。例如，假设您想检查用户是否可以“浏览”帖子，很简单，我们可以使用以下语法：")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[t._v("@"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("can")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'browse'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$post")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("I")]),t._v(" can browse posts\n@endcan\n")])])]),e("p",[t._v("或者您可能需要运行其他条件才能获得许可。很简单：")]),t._v(" "),e("div",{staticClass:"language-php extra-class"},[e("pre",{pre:!0,attrs:{class:"language-php"}},[e("code",[t._v("@"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("can")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token single-quoted-string string"}},[t._v("'browse'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$post")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("I")]),t._v(" can browse posts\n@"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("I")]),t._v(" cannot browse posts\n@endcan\n")])])]),e("p",[t._v("再简单不过了，对吧")])])}),[],!1,null,null,null);s.default=n.exports}}]);